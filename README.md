# WebSocket Chat Application with Vite + React, Node.js, and MySQL

## Описание проекта

Это приложение — одностраничное веб-приложение (SPA) для чата в реальном времени, созданное с использованием **React** на фронтенде и **Node.js** с **Express** на бэкенде. Для передачи сообщений в реальном времени используется **WebSocket** через библиотеку **Socket.IO**. Данные сообщений и пользователей сохраняются в базе данных **MySQL** при помощи **ORM Sequelize**. Также используется **Redis** для управления очередью сообщений.

## Основные функции:

- **Чат в реальном времени** с возможностью отправки текстовых сообщений, изображений и текстовых файлов
- **Регистрация пользователей** через email и Google OAuth
- **Восстановление пароля** с отправкой инструкции на email
- **Ответы на сообщения** с отображением вложенных комментариев
- **Пагинация страниц** для удобной навигации по чату
- **Фильтрация и сортировка сообщений** по имени пользователя, email и дате
- **Капча для защиты от ботов**
- **Валидация и санитизация данных** для обеспечения безопасности

## Стек технологий:

- **Frontend**: React, CSS Modules, Socket.IO Client
- **Backend**: Node.js, Express, Socket.IO, Multer, Sharp, MySQL
- **База данных**: MySQL
- **ORM**: Sequelize
- **Redis**: для управления очередями сообщений с BullMQ
- **WebSocket**: Socket.IO для передачи данных в реальном времени
- **Аутентификация**: JWT и Google OAuth
- **Docker**: Контейнеризация для упрощённого развертывания

## Установка и настройка:

1. Клонирование репозитория:
   Склонируйте репозиторий на локальную машину:
   git clone https://github.com/ecoaurum/spa-app-websocket.git

2. Настройка backend:

- Создайте файл .env в директории server/ с параметрами для подключения к базе данных:
- MYSQLHOST=<Ваш_хост>

  MYSQLUSER=<Ваш_пользователь>

  MYSQLPASSWORD=<Ваш_пароль>

  MYSQLDATABASE=<Имя*базы*данных>

  MYSQLPORT=<Порт*базы*данных> # по умолчанию 3306

  PORT=<Порт_сервера> # по умолчанию 5000

  CLIENT*URL=<URL*фронтенда>

  REDIS*URL=<URL_Redis*сервиса>

  JWT*SECRET=<Секретный*ключ_JWT>

  GOOGLE*CLIENT_ID=<Идентификатор*клиента_Google>

  GOOGLE*CLIENT_SECRET=<Секретный*ключ_клиента_Google>

- Перейдите в папку server и установите все зависимости:
- cd server

  npm install

- Затем запустите сервер разработки ( Сервер будет запущен по адресу, который указан в настройках хостинга):
- npm start

3. Настройка frontend:

- Создайте файл .env в директории client/ с параметрами для подключения фронтенда:
- VITE_API_URL=https://spa-app-websocket-server.up.railway.app
- Перейдите в папку client и установите все зависимости:
- cd client

  npm install

- Запустите фронтенд приложение (Фронтенд будет доступен по адресу, который указан при деплое на хостинг.):
- npm run dev

4. Запуск с Docker:

   - Проект также можно запустить с использованием Docker. Для этого выполните следующие шаги:

     1. Убедитесь, что у вас установлен Docker.

     2. Выполните команду для сборки и запуска контейнеров:

        - docker-compose up --build

   - Docker создаст контейнеры для фронтенда, бэкенда, Redis и базы данных MySQL.

5. Использование

- Фронтенд:

  - Основные компоненты:

    - ChatPage: Основная страница чата с компонентами сообщений и отправки сообщений.
    - MessageBlock: Компонент для ввода и отправки сообщений, поддерживает отправку изображений, текстовых файлов и работу с CAPTCHA.
    - Body: Компонент для отображения списка сообщений с поддержкой ответов и вложенных комментариев.
    - Pagination: Компонент для переключения между страницами сообщений.

  - Ключевые функции:
    - Регистрация и Вход: Через email и Google OAuth
    - Восстановление пароля: Запрос для восстановления пароля с подтверждением через email.
    - Отправка сообщений: Пользователи могут отправлять текстовые сообщения, загружать изображения и текстовые файлы. Поддерживается предпросмотр сообщения перед отправкой
    - Ответы на сообщения: Поддерживается ответ на конкретные сообщения с отображением цитируемого текста.
    - Сортировка сообщений: Сообщения можно сортировать по имени пользователя, email и дате
    - Модальные окна для изображений: Изображения, загруженные пользователями, можно просматривать в увеличенном виде

- Бэкенд:

  - Основные маршруты:
    - /api/messages: Управление сообщениями (получение, создание, ответы)
    - /api/upload-image: Загрузка изображений на сервер
    - /api/upload-file: Загрузка текстовых файлов на сервер
    - /api/captcha: Генерация CAPTCHA для защиты от ботов
  - Взаимодействие с WebSocket:
    - Событие newMessage: Событие для отправки нового сообщения в чат в реальном времени
    - Событие getMessages: Получение сообщений с пагинацией по страницам
    - Событие messagesPage: Отправка сообщений на фронтенд с учётом текущей страницы
  - Очереди Redis (BullMQ):
    - Использование очереди для управления доставкой сообщений в Redis

- Безопасность и защита
  - **Валидация и санитизация**: Вся информация проходит проверку и обработку для защиты данных
  - **CAPTCHA**: Реализована CAPTCHA для предотвращения автоматических отправок
  - **Redis и очереди сообщений**: Управление очередью сообщений для оптимизации и безопасной передачи данных
